# 开始
你即将开始进行下一个项目，这次它将运行在Linux。在你把手指放在键盘之前，你应该考虑什么？让我们先从高层次了解嵌入式Linux，看看它为何受欢迎，开源许可证的含义是什么，以及运行Linux需要什么样的硬件。
1999年左右，Linux首次成为嵌入式设备的可行选择。当时，Axis(https://www.axis.com )发布了他们的第一款网络摄像头，同时TiVo(https://bussiness.tivo.com )发布了他们的第一台数字视频录像机(DVR)。自1999年以来，Linux变得越来越流行，以至于它是当前诸多类别产品的首选操作系统。2021年，有超过20亿台设备运行Linux操纵系统。这其中包括大量运行Android（使用Linux内核）的智能手机，以及数亿个机顶盒，智能电视与Wi-Fi路由器，更不用说体积较小的各种设备，如车辆诊断仪、称重设备、工业设备与医疗监控设备。

在这一章，我们将会覆盖一下内容：
- Linux的选择
- 何时不该使用Linux
- 与玩家见面
- 贯穿项目生命周期
- 开源导航
- 选择嵌入式Linux的硬件
- 获取适合于本书的硬件
- 配置开发环境

## Linux的选择
为什么Linux如此普遍被使用？以及为什么像TV这么简单的东西也需要运行完整的Linux来在屏幕上显示流媒体视频。
最简单的原因就是摩尔定律：Intel的联合创始人Gordon Moore在1965年发现，芯片上的晶体管密度每两年翻一番。这适用于我们在日常生活中设计和使用的设备，就像适用于台式机、笔记本电脑和服务器一样。大多数嵌入式设备的核心是一个高度集成的芯片，它包含一个或多个处理器内核以及与主存储器、大容量存储器和多种类型外围设备的接口。这被称为片上系统或SoC，并且SoC的复杂性根据摩尔定律不断增加。典型的SoC具有长达数千页的技术参考手册。您的电视不只是像过去的旧模拟电视机那样简单地显示视频流。
视频流是数字的，有可能被加密了，并且需要处理才能创建图像。您的电视已经（或者即将）连接到互联网。它可以接受来自智能手机、平板电脑和家庭媒体服务器的内容。它可以（或即将）用于玩游戏等。您需要一个完整的操作系统来管理这种程度的复杂性。
以下是推动采用Linux的一些要点：
- Linux具有必要的功能。它具有良好的调度器、良好的网络堆栈、支持USB、Wi-Fi、蓝牙、多种存储介质、良好的多媒体设备支持等。它符合所有条件。
- Linux已经移植到范围广泛的处理器架构中，包括一些在SoC设计中非常厂家的架构--Arm、MIPS、x86和PowerPC。
- Linux是开源的，因此您可以自由获取源代码并对其进行修改以满足您的需要。您或者为您工作的人可以为您的特定SoC板或设备创建板级支持包。您可以添加主线代码中可能缺少的协议、功能和技术。您可以删除不需要的功能已减少内存或者存储要求。Linux是灵活的。
- Linux有一个活跃的社区；尤其是Linux内核，非常活跃。内核每8到10周发布一次新版本，每个版本包含1000多名开发人员的代码。活跃的社区意味着Linux是最新的，并支持当前的硬件、协议和标准。
- 开源许可证保证您可以获取源代码。没有供应商搭售。

因为这些原因，Linux对于复杂设备的理想选择。但这里有几点需要注意的地方。复杂性使人难以理解。加上快速发展的开发过程和开源的去中心化结构，你必须努力学习如何使用它，并在它发生变化时继续重新学习。我希望这本书能在这个过程中有所帮助。

## 什么时候不选择Linux
Linux是否符合你的项目？Linux在那些已经被证明了问题复杂性的地方工作良好。尤其适合于需要连通性、健壮性和复杂用户界面的情况下。然而，它不能解决所有问题，因此在您加入之前，需要考虑以下几点：
- 你的硬件够用吗？相比较VxWorks或者QNX等传统实时操作系统（RTOS），Linux需要消耗更多的资源。它至少需要一个32位的处理器与更多内存。我将在有关典型硬件要求的部分进行更详细的介绍。
- 你有合适的技能栈吗？项目的早期部分，电路板的bring-up需要对Linux有详细的了解并将其与您的硬件联系起来。同样，在调试与调整您的应用程序时，您需要能明白结果。如果你不具备内行的技能，可能需要将这部分工作外包。当然，本书会对此有帮助。
- 你的系统是实时的吗？只要你注意一些细节，Linux就可以处理许多实时操作，我会在第21章实时编程中详细介绍。
- 你的代码是否需要监管部门的批准（医疗、汽车、航空航天等）？法规验证和验证的负担可能意味着另一个系统是更好的选择。即使你确实在这些环境选择Linux，从为现有产品（例如你正在构建的产品）提供Linux的公司购买商业发行版也可能是有意义的。
  
你要仔细考虑这些要点。一个可能有用指标是去寻找运行Linux的类似产品，看看他们是如何做到的；遵循最佳实践。

## 与玩家见面 
开源工具从何而来？谁写的这些软件？特别是，这与嵌入式开发的关键组件（工具链、bootloader、内核、根文件系统中的基本实用程序）有何关系？
主要的参与者如下：
- **开源社区**:毕竟，这是生成你即将使用软件的引擎。社区是开发人员的松散联盟，其中许多人以某种方式获得资助，可能来自非盈利组织、学术机构或者商业公司。他们共同努力，以推进各种项目的目标。它们有很多，大小也不一样。我们将在本书的其余部分中使用的一些项目包括Linux本身、U-Boot、BusyBox、Buildroot、Yocto Project与以及GNU保护伞下的许多项目。
- **CPU架构师**：这些是设计我们所使用CPU的组织。这里最重要的是Arm/Linaro（Arm Cortex-A）、Intel（x86和x86_64），SiFive（RISC-V）和IBM（PoverPC）。他们实现或者至少影响对基本CPU架构的支持。
- **SoC供应商（Broadcom、Intel、Microchip、NXP、Qualcomm、TI等）**：他们从CPU架构师那里获取内核和工具链，并对其进行修改以支持他们的芯片。他们还创建参考板：下一级用于创建开发板和工作产品的设计。
- **电路板供应商和OEM**：这些人从SoC供应商那里获取参考设计并将它构建到特定产品中，例如机顶盒或者相机，或者创建更通用的开发板，例如Advantech和Kontron。一个重要的类别是便宜的开发板，例如BeagleBoard/BeagleBone和Raspberry Pi ，它们已经创建了自己的软件和硬件附加组件生态系统。
- **商业Linux供应商**：Siemens(Mentor)、Timesys和Wind River等公司提供商业Linux发行版，这些发行版以及经过多个行业（医疗、汽车、航空航天等）的严格监管验证与认证。
  
这是一个链条，你的项目往往在最后，这意味着你不能自由选择组件，你不能简单的从https://www.kernel.org/ 获取最新的内核，除非在极少数情况下，这是因为它往往不能支持你所使用的芯片与板。

这是嵌入式开发一直存在的问题。理想情况下，链中的每一个环节开发人员都会将他们的更改推送到上游，但他们没有这么做。数千个未合并补丁的内核并不罕见。此外，SoC供应商往往只会为其最新的芯片积极开发开源组件，这意味着对任何超过几年的芯片支持将被冻结并且不会收到任何更新。
结果是，大多数嵌入式设计都基于旧版本的软件。他们不会收到更新版本中的安全修复、性能增强或功能。Heartbleed（OpenSSL库中的错误）和ShellSlock（bash shell中的错误）等问题未得到修复，我将在本章稍后的安全主题中详细讨论这一点。
你能为这个做什么？首先，询问你的供应商(NXP、德州仪器和Xilink等)：他们的更新政策是什么，他们多久修改一次内核版本，之前的版本是什么，他们在上游合并更改的政策是什么？一些供应商正在以这种方式获得长足进步，你应该喜欢他们的筹码。
其次，你可以采取措施让自己更加自给自足。第一部分的章节更详细的解释了依赖关系，并向你展示了您可以在哪些方面提供帮助。不要只会使用SoC或者板卡供应商提供给你的包，盲目使用而不考虑替代方案。

## 贯穿项目生命周期
本书分为四个部分，反映了项目的各个阶段。这些阶段不一定是连续的。通常，它们会重叠，您需要跳回去重新审视之前完成的事情。然而，它们代表了开发人员在项目进展中所关注的问题。
- _嵌入式Linux的组成（1到8章）_ 将会帮助你设置开发环境并为后期阶段创建工作平台。它们通常称为电路板的**bring-up**阶段。
- _系统架构与设计决策（9到15章）_ 将帮助你了解你必须做出的设计决策，设计程序与数据的存储、如何在内核设备驱动程序与应用程序之间分配工作以及如何初始化系统。
- _编写嵌入式应用程序（16到18章）_ 展示了如何打包和部署Python程序，有效利用Linux进程与线程模型，以及如何在资源受限的情况下管理内存。
- _调试与性能优化（19到21章）_ 描述了如何在应用程序与内核中跟踪、剖析和调试代码，最后一章介绍了如何在需要时设计实时程序。
  
现在，让我们关注构成本书第一部分的嵌入式 Linux 的四个基本元素。